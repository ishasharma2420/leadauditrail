<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>AI Intelligence Dashboard</title>
<link href="https://fonts.googleapis.com/css2?family=Bricolage+Grotesque:opsz,wght@12..96,400;12..96,500;12..96,600;12..96,700;12..96,800&family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">
<style>
  :root {
    --bg: #f5f6f8;
    --white: #ffffff;
    --border: #e8eaef;
    --border-soft: #f0f1f4;
    --text: #0f1117;
    --text-muted: #7b8194;
    --text-dim: #9da3b4;
    --flash: #0066ff;
    --flash-light: #eff4ff;
    --flash-mid: #dbeafe;
    --flash-border: #bfdbfe;
    --sherlock: #7c3aed;
    --sherlock-light: #f5f0ff;
    --sherlock-border: #ddd6fe;
    --hawke: #059669;
    --hawke-light: #ecfdf5;
    --hawke-mid: #d1fae5;
    --hawke-border: #a7f3d0;
    --invorto: #ea580c;
    --invorto-light: #fff7ed;
    --invorto-border: #fdba74;
    --sev-high-bg: #fef2f2; --sev-high: #dc2626; --sev-high-border: #fecaca;
    --sev-med-bg: #fffbeb;  --sev-med: #d97706;  --sev-med-border: #fde68a;
    --sev-low-bg: #f0fdf4;  --sev-low: #16a34a;  --sev-low-border: #bbf7d0;
  }
  * { margin:0; padding:0; box-sizing:border-box; }
  body { background:var(--bg); color:var(--text); font-family:'Inter',sans-serif; font-size:13px; line-height:1.5; min-height:100vh; }
  .wrapper { padding:14px; max-width:100%; }

  .header { display:flex; align-items:center; justify-content:space-between; margin-bottom:12px; }
  .header-left { display:flex; align-items:center; gap:8px; }
  .pulse-ring { position:relative; width:10px; height:10px; flex-shrink:0; }
  .pulse-ring::before { content:''; position:absolute; inset:0; background:var(--flash); border-radius:50%; animation:pulse 2s ease-in-out infinite; }
  .pulse-ring::after { content:''; position:absolute; inset:-3px; border:1.5px solid var(--flash); border-radius:50%; opacity:0; animation:pulse-ring 2s ease-in-out infinite; }
  @keyframes pulse { 0%,100%{transform:scale(1);opacity:1;} 50%{transform:scale(0.85);opacity:0.7;} }
  @keyframes pulse-ring { 0%{transform:scale(0.7);opacity:0.8;} 100%{transform:scale(1.4);opacity:0;} }
  .header-title { font-family:'Bricolage Grotesque',sans-serif; font-size:13px; font-weight:700; color:var(--text); }
  .header-sub { font-size:11px; color:var(--text-muted); }

  /* Single column stack */
  .stack { display:flex; flex-direction:column; gap:10px; }

  .card { background:var(--white); border-radius:14px; border:1px solid var(--border); overflow:hidden; transition:box-shadow 0.2s ease,transform 0.2s ease; animation:fadeUp 0.4s ease both; }
  .card:hover { transform:translateY(-1px); box-shadow:0 4px 20px rgba(0,0,0,0.07); }
  .card:nth-child(1){animation-delay:0.04s;} .card:nth-child(2){animation-delay:0.08s;} .card:nth-child(3){animation-delay:0.12s;} .card:nth-child(4){animation-delay:0.16s;}
  @keyframes fadeUp { from{opacity:0;transform:translateY(8px);} to{opacity:1;transform:translateY(0);} }

  .card-bar { height:3px; }
  .bar-flash    { background:linear-gradient(90deg,var(--flash),#60a5fa); }
  .bar-sherlock { background:linear-gradient(90deg,var(--sherlock),#a78bfa); }
  .bar-hawke    { background:linear-gradient(90deg,var(--hawke),#34d399); }
  .bar-invorto  { background:linear-gradient(90deg,var(--invorto),#fb923c); }

  .card-head { display:flex; align-items:center; justify-content:space-between; padding:12px 14px 10px; border-bottom:1px solid var(--border-soft); }
  .agent-id { display:flex; align-items:center; gap:9px; }
  .agent-icon { width:30px; height:30px; border-radius:8px; display:flex; align-items:center; justify-content:center; font-size:14px; flex-shrink:0; }
  .icon-flash{background:var(--flash-light);} .icon-sherlock{background:var(--sherlock-light);} .icon-hawke{background:var(--hawke-light);} .icon-invorto{background:var(--invorto-light);}
  .agent-name { font-family:'Bricolage Grotesque',sans-serif; font-size:13px; font-weight:700; color:var(--text); line-height:1.2; }
  .agent-role { font-size:10.5px; color:var(--text-muted); margin-top:1px; }

  .pill { font-size:10px; font-weight:600; letter-spacing:0.05em; text-transform:uppercase; padding:3px 8px; border-radius:20px; }
  .pill-active{background:#dcfce7;color:#15803d;} .pill-review{background:var(--sev-med-bg);color:var(--sev-med);} .pill-pending{background:#fef9c3;color:#a16207;} .pill-none{background:var(--bg);color:var(--text-muted);}

  .card-body { padding:12px 14px 14px; }

  /* No agents state */
  .all-empty { text-align:center; padding:48px 24px; }
  .all-empty-emoji { font-size:36px; margin-bottom:10px; animation:float 3s ease-in-out infinite; }
  @keyframes float { 0%,100%{transform:translateY(0);} 50%{transform:translateY(-5px);} }
  .all-empty-title { font-family:'Bricolage Grotesque',sans-serif; font-size:14px; font-weight:700; color:var(--text-muted); margin-bottom:4px; }
  .all-empty-sub { font-size:12px; color:var(--text-dim); }

  /* Score hero */
  .score-hero { display:flex; align-items:center; gap:10px; background:var(--flash-light); border:1px solid var(--flash-border); border-radius:10px; padding:10px 12px; margin-bottom:11px; }
  .score-ring { position:relative; width:46px; height:46px; flex-shrink:0; }
  .score-ring svg { width:46px; height:46px; transform:rotate(-90deg); }
  .ring-bg { fill:none; stroke:var(--flash-border); stroke-width:3.5; }
  .ring-fill { fill:none; stroke:var(--flash); stroke-width:3.5; stroke-linecap:round; transition:stroke-dashoffset 1s cubic-bezier(.4,0,.2,1); }
  .score-num { position:absolute; inset:0; display:flex; align-items:center; justify-content:center; font-family:'Bricolage Grotesque',sans-serif; font-size:13px; font-weight:800; color:var(--flash); }
  .score-label { font-size:10px; color:var(--text-muted); text-transform:uppercase; letter-spacing:0.07em; }
  .score-bucket { font-family:'Bricolage Grotesque',sans-serif; font-size:16px; font-weight:800; line-height:1.1; margin-top:2px; }
  .bkt-high{color:var(--flash);} .bkt-medium{color:var(--sev-med);} .bkt-low{color:var(--text-muted);}

  .fields { display:flex; flex-direction:column; gap:9px; }
  .field { display:flex; flex-direction:column; gap:2px; }
  .f-label { font-size:10px; font-weight:600; letter-spacing:0.07em; text-transform:uppercase; color:var(--text-muted); }
  .f-val { font-size:12px; color:var(--text); line-height:1.4; }
  .f-val.c-flash{color:var(--flash);font-weight:500;} .f-val.c-sherlock{color:var(--sherlock);font-weight:500;} .f-val.c-hawke{color:var(--hawke);font-weight:500;} .f-val.c-invorto{color:var(--invorto);font-weight:500;}

  .conf-wrap { display:flex; align-items:center; gap:7px; margin-top:3px; }
  .conf-track { flex:1; height:5px; background:var(--border); border-radius:3px; overflow:hidden; }
  .conf-fill { height:100%; border-radius:3px; transition:width 1s cubic-bezier(.4,0,.2,1); }
  .cf-hawke { background:linear-gradient(90deg,var(--hawke-mid),var(--hawke)); }
  .conf-num { font-family:'Bricolage Grotesque',sans-serif; font-size:12px; font-weight:700; min-width:26px; text-align:right; }
  .cn-hawke { color:var(--hawke); }

  /* Two col row for mini fields */
  .two-col { display:grid; grid-template-columns:1fr 1fr; gap:8px; margin-bottom:10px; }

  .badge { display:inline-flex; align-items:center; gap:4px; padding:2px 8px; border-radius:4px; font-size:10px; font-weight:700; letter-spacing:0.06em; text-transform:uppercase; }
  .badge::before { content:''; width:4px; height:4px; border-radius:50%; background:currentColor; }
  .badge-high{background:var(--sev-high-bg);color:var(--sev-high);border:1px solid var(--sev-high-border);}
  .badge-medium{background:var(--sev-med-bg);color:var(--sev-med);border:1px solid var(--sev-med-border);}
  .badge-low{background:var(--sev-low-bg);color:var(--sev-low);border:1px solid var(--sev-low-border);}

  .anomaly-chip { display:inline-block; background:var(--hawke-light); border:1px solid var(--hawke-border); border-radius:6px; padding:3px 9px; font-family:'Bricolage Grotesque',sans-serif; font-size:11px; font-weight:700; color:var(--hawke); }

  .insight-block { margin-top:10px; padding:9px 11px; border-radius:8px; font-size:11.5px; line-height:1.6; color:var(--text-muted); font-style:italic; }
  .ib-flash    { background:var(--flash-light);    border:1px solid var(--flash-border);    border-left:2.5px solid var(--flash); }
  .ib-sherlock { background:var(--sherlock-light); border:1px solid var(--sherlock-border); border-left:2.5px solid var(--sherlock); }
  .ib-hawke    { background:var(--hawke-light);    border:1px solid var(--hawke-border);    border-left:2.5px solid var(--hawke); }

  .hdivider { height:1px; background:var(--border-soft); margin:8px 0; }

  .footer { margin-top:14px; text-align:center; font-size:10px; color:var(--text-dim); letter-spacing:0.07em; text-transform:uppercase; }
  .footer strong { background:linear-gradient(90deg,var(--flash),var(--sherlock)); -webkit-background-clip:text; -webkit-text-fill-color:transparent; }
</style>
</head>
<body>
<div class="wrapper">
  <div class="header">
    <div class="header-left">
      <div class="pulse-ring"></div>
      <div class="header-title">AI Lab Intelligence</div>
    </div>
    <div class="header-sub" id="lastUpdated">Loading‚Ä¶</div>
  </div>
  <div class="stack" id="stack"></div>
  <div class="footer">Powered by <strong>LeadSquared AI Lab</strong></div>
</div>

<script>
  function p(n) {
    try { return decodeURIComponent(new URL(window.location.href).searchParams.get(n) || ''); }
    catch(e) { return ''; }
  }

  function setBadgeHTML(val) {
    const v = (val||'').toUpperCase();
    const cls = v==='HIGH'?'badge-high':v==='LOW'?'badge-low':'badge-medium';
    return `<span class="badge ${cls}">${val||'‚Äî'}</span>`;
  }

  function pillHTML(val, fallback) {
    const display = val || fallback || 'Active';
    const v = display.toLowerCase();
    const cls = v==='active'?'pill-active':v==='review'?'pill-review':v==='pending'?'pill-pending':'pill-none';
    return `<div class="pill ${cls}">${display}</div>`;
  }

  function cardHTML(barClass, iconClass, emoji, name, role, pillVal, pillFallback, bodyHTML) {
    return `<div class="card">
      <div class="card-bar ${barClass}"></div>
      <div class="card-head">
        <div class="agent-id">
          <div class="agent-icon ${iconClass}">${emoji}</div>
          <div><div class="agent-name">${name}</div><div class="agent-role">${role}</div></div>
        </div>
        ${pillHTML(pillVal, pillFallback)}
      </div>
      <div class="card-body">${bodyHTML}</div>
    </div>`;
  }

  (function run() {
    document.getElementById('lastUpdated').textContent =
      'Updated ' + new Date().toLocaleTimeString([],{hour:'2-digit',minute:'2-digit'});

    const stack = document.getElementById('stack');
    let rendered = 0;

    // ‚îÄ‚îÄ FLASH ‚îÄ‚îÄ
    const fScore  = p('mx_AI_Readiness_Score');
    const fBucket = p('mx_Readiness_Bucket');
    const fIntent = p('mx_AI_Detected_Intent');
    const fReason = p('mx_AI_Reasoning');

    if (fScore || fBucket || fIntent || fReason) {
      const n = Math.min(100, Math.max(0, parseInt(fScore)||0));
      const offset = (119.38 - (n/100)*119.38).toFixed(2);
      const bktCls = (fBucket||'').toLowerCase()==='high'?'bkt-high':(fBucket||'').toLowerCase()==='medium'?'bkt-medium':'bkt-low';
      const body = `
        <div class="score-hero">
          <div class="score-ring">
            <svg viewBox="0 0 46 46">
              <circle class="ring-bg" cx="23" cy="23" r="19"/>
              <circle class="ring-fill" id="fring" cx="23" cy="23" r="19" stroke-dasharray="119.38" stroke-dashoffset="119.38"/>
            </svg>
            <div class="score-num">${n||'‚Äî'}</div>
          </div>
          <div>
            <div class="score-label">Readiness Score</div>
            <div class="score-bucket ${bktCls}">${fBucket||'‚Äî'}</div>
          </div>
        </div>
        <div class="fields">
          <div class="field"><div class="f-label">Detected Intent</div><div class="f-val c-flash">${fIntent||'‚Äî'}</div></div>
        </div>
        ${fReason ? `<div class="insight-block ib-flash"><div class="f-label" style="margin-bottom:4px">AI Reasoning</div>${fReason}</div>` : ''}`;
      stack.innerHTML += cardHTML('bar-flash','icon-flash','‚ö°','Agent Flash','60 Seconds to Schedule','Active','Active',body);
      rendered++;
      setTimeout(()=>{ const r=document.getElementById('fring'); if(r) r.style.strokeDashoffset=offset; },150);
    }

    // ‚îÄ‚îÄ SHERLOCK ‚îÄ‚îÄ
    const sStatus   = p('mx_QA_Status');
    const sRisk     = p('mx_QA_Risk_Level');
    const sSummary  = p('mx_QA_Summary');
    const sFindings = p('mx_QA_Key_Findings');
    const sAdvisory = p('mx_QA_Advisory_Notes');
    const sConcerns = p('mx_QA_Concerns');

    if (sStatus || sRisk || sSummary || sFindings) {
      const body = `
        <div class="two-col">
          <div class="field"><div class="f-label">QA Status</div><div class="f-val c-sherlock">${sStatus||'‚Äî'}</div></div>
          <div class="field"><div class="f-label">Risk Level</div>${setBadgeHTML(sRisk)}</div>
        </div>
        <div class="fields">
          ${sSummary  ? `<div class="field"><div class="f-label">QA Summary</div><div class="f-val">${sSummary}</div></div>` : ''}
          ${sFindings ? `<div class="field"><div class="f-label">Key Findings</div><div class="f-val">${sFindings}</div></div>` : ''}
          ${sAdvisory ? `<div class="field"><div class="f-label">Advisory Notes</div><div class="f-val">${sAdvisory}</div></div>` : ''}
        </div>
        ${sConcerns ? `<div class="insight-block ib-sherlock">${sConcerns}</div>` : ''}`;
      stack.innerHTML += cardHTML('bar-sherlock','icon-sherlock','üîç','Agent Sherlock','Application QA Review',sStatus,'Review',body);
      rendered++;
    }

    // ‚îÄ‚îÄ HAWKE ‚îÄ‚îÄ
    const hType   = p('mx_Latest_Anomaly_Type');
    const hSev    = p('mx_Latest_Anomaly_Severity');
    const hConf   = p('mx_Latest_Anomaly_Confidence');
    const hRun    = p('mx_Last_Intelligence_Run');
    const hExp    = p('mx_Latest_Anomaly_Explanation');
    const hStatus = p('mx_AI_Anomaly_Status');

    if (hType || hSev || hConf || hExp) {
      const hN = Math.min(100, Math.max(0, parseInt(hConf)||0));
      const body = `
        <div class="two-col">
          <div class="field"><div class="f-label">Anomaly Type</div><span class="anomaly-chip">${hType||'‚Äî'}</span></div>
          <div class="field"><div class="f-label">Severity</div>${setBadgeHTML(hSev)}</div>
        </div>
        <div class="fields">
          <div class="field">
            <div class="f-label">Confidence</div>
            <div class="conf-wrap">
              <div class="conf-track"><div class="conf-fill cf-hawke" id="hbar" style="width:0%"></div></div>
              <div class="conf-num cn-hawke">${hN||'‚Äî'}</div>
            </div>
          </div>
          ${hRun ? `<div class="field"><div class="f-label">Last Intelligence Run</div><div class="f-val c-hawke">${hRun}</div></div>` : ''}
        </div>
        ${hExp ? `<div class="insight-block ib-hawke">${hExp}</div>` : ''}`;
      stack.innerHTML += cardHTML('bar-hawke','icon-hawke','ü¶Ö','Agent Hawke','Anomaly Detection',hStatus,'Active',body);
      rendered++;
      setTimeout(()=>{ const b=document.getElementById('hbar'); if(b) b.style.width=hN+'%'; },200);
    }

    // ‚îÄ‚îÄ INVORTO ‚îÄ‚îÄ
    const iHes      = p('mx_Primary_Hesitation');
    const iMotiv    = p('mx_Motivation_Trigger');
    const iOwner    = p('mx_Decision_Owner');
    const iTimeline = p('mx_Enrollment_Timeline_Voice_Call');

    if (iHes || iMotiv || iOwner || iTimeline) {
      const body = `
        <div class="fields">
          ${iHes      ? `<div class="field"><div class="f-label">Primary Hesitation</div><div class="f-val">${iHes}</div></div>` : ''}
          ${iMotiv    ? `<div class="field"><div class="f-label">Motivation Trigger</div><div class="f-val c-invorto">${iMotiv}</div></div>` : ''}
          ${iOwner || iTimeline ? '<div class="hdivider"></div>' : ''}
          ${iOwner    ? `<div class="field"><div class="f-label">Decision Owner</div><div class="f-val">${iOwner}</div></div>` : ''}
          ${iTimeline ? `<div class="field"><div class="f-label">Enrollment Timeline</div><div class="f-val">${iTimeline}</div></div>` : ''}
        </div>`;
      stack.innerHTML += cardHTML('bar-invorto','icon-invorto','üéôÔ∏è','Invorto Voice','Call Qualification','Active','Active',body);
      rendered++;
    }

    // ‚îÄ‚îÄ ALL EMPTY ‚îÄ‚îÄ
    if (rendered === 0) {
      stack.innerHTML = `<div class="all-empty">
        <div class="all-empty-emoji">ü§ñ</div>
        <div class="all-empty-title">The agents are on standby.</div>
        <div class="all-empty-sub">No analysis has been run on this lead yet. Check back after the first automation trigger.</div>
      </div>`;
    }

  })();
</script>
</body>
</html>
