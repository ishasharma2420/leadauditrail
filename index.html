<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>AI Lab Intelligence</title>
<link rel="preconnect" href="https://fonts.googleapis.com">
<link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
<link href="https://fonts.googleapis.com/css2?family=Bricolage+Grotesque:opsz,wght@12..96,400;12..96,500;12..96,600;12..96,700&family=Inter:wght@300;400;500;600&display=swap" rel="stylesheet">
<style>
  *, *::before, *::after { box-sizing: border-box; margin: 0; padding: 0; }

  :root {
    --bg: #f4f6f9;
    --card-bg: #ffffff;
    --text-primary: #0f1728;
    --text-secondary: #5a6478;
    --text-muted: #8c95a6;
    --border: #e4e8f0;
    --shadow: 0 1px 4px rgba(15,23,40,0.06), 0 4px 16px rgba(15,23,40,0.04);
    --shadow-hover: 0 2px 8px rgba(15,23,40,0.08), 0 8px 24px rgba(15,23,40,0.08);
    --radius: 12px;

    --flash-color: #2563eb;    --flash-light: #eff6ff;    --flash-mid: #bfdbfe;
    --sherlock-color: #7c3aed; --sherlock-light: #f5f3ff;  --sherlock-mid: #ddd6fe;
    --hawke-color: #059669;    --hawke-light: #ecfdf5;    --hawke-mid: #a7f3d0;
    --invorto-color: #d97706;  --invorto-light: #fffbeb;  --invorto-mid: #fde68a;
  }

  body {
    font-family: 'Inter', sans-serif;
    background: var(--bg);
    color: var(--text-primary);
    padding: 16px;
    font-size: 13px;
    line-height: 1.5;
  }

  /* Header */
  .header { display:flex; align-items:center; justify-content:space-between; margin-bottom:18px; padding-bottom:14px; border-bottom:1px solid var(--border); }
  .header-title { font-family:'Bricolage Grotesque',sans-serif; font-size:15px; font-weight:700; letter-spacing:-0.2px; }
  .header-sub { font-size:11px; color:var(--text-muted); margin-top:1px; }
  .header-badge { font-size:10px; font-weight:600; padding:3px 9px; background:#0f1728; color:#fff; border-radius:20px; letter-spacing:0.5px; text-transform:uppercase; }

  /* Card */
  .card { background:var(--card-bg); border-radius:var(--radius); box-shadow:var(--shadow); margin-bottom:12px; overflow:hidden; border:1px solid var(--border); transition:box-shadow 0.2s; animation:cardIn 0.4s ease both; }
  .card:hover { box-shadow:var(--shadow-hover); }
  .card:nth-child(1){animation-delay:.04s} .card:nth-child(2){animation-delay:.09s}
  .card:nth-child(3){animation-delay:.14s} .card:nth-child(4){animation-delay:.19s}
  @keyframes cardIn { from{opacity:0;transform:translateY(10px)} to{opacity:1;transform:translateY(0)} }

  .card-accent { height:3px; }
  .flash    .card-accent { background:linear-gradient(90deg,#2563eb,#60a5fa); }
  .hawke    .card-accent { background:linear-gradient(90deg,#059669,#34d399); }
  .sherlock .card-accent { background:linear-gradient(90deg,#7c3aed,#a78bfa); }
  .invorto  .card-accent { background:linear-gradient(90deg,#d97706,#fbbf24); }

  .card-header { display:flex; align-items:center; gap:10px; padding:12px 16px 10px; border-bottom:1px solid var(--border); }
  .agent-icon { width:30px; height:30px; border-radius:8px; display:flex; align-items:center; justify-content:center; font-size:15px; flex-shrink:0; }
  .flash    .agent-icon { background:var(--flash-light); }
  .hawke    .agent-icon { background:var(--hawke-light); }
  .sherlock .agent-icon { background:var(--sherlock-light); }
  .invorto  .agent-icon { background:var(--invorto-light); }

  .agent-name    { font-family:'Bricolage Grotesque',sans-serif; font-size:13px; font-weight:700; }
  .agent-tagline { font-size:10px; color:var(--text-muted); }
  .agent-status  { margin-left:auto; font-size:10px; font-weight:600; padding:2px 8px; border-radius:10px; text-transform:uppercase; letter-spacing:0.3px; }
  .status-active { background:#dcfce7; color:#15803d; }
  .status-soon   { background:#f1f5f9; color:var(--text-muted); }

  .card-body { padding:14px 16px 16px; }

  /* Score ring */
  .score-row { display:flex; align-items:center; gap:16px; margin-bottom:14px; }
  .score-ring-wrap { position:relative; width:68px; height:68px; flex-shrink:0; }
  .score-ring-wrap svg { transform:rotate(-90deg); display:block; }
  .score-ring-bg   { fill:none; stroke:var(--border); stroke-width:5.5; }
  .score-ring-fill { fill:none; stroke-width:5.5; stroke-linecap:round; transition:stroke-dashoffset 1.3s cubic-bezier(.34,1.56,.64,1); }
  .score-value { position:absolute; inset:0; display:flex; flex-direction:column; align-items:center; justify-content:center; font-family:'Bricolage Grotesque',sans-serif; font-size:20px; font-weight:700; line-height:1; }
  .score-value small { font-size:8px; font-weight:500; color:var(--text-muted); margin-top:2px; font-family:'Inter',sans-serif; }
  .score-meta { flex:1; }
  .readiness-label  { font-size:10px; font-weight:600; text-transform:uppercase; letter-spacing:0.5px; color:var(--text-muted); margin-bottom:3px; }
  .readiness-bucket { font-family:'Bricolage Grotesque',sans-serif; font-size:22px; font-weight:700; line-height:1.1; }
  .bucket-high   { color:#16a34a; }
  .bucket-medium { color:#d97706; }
  .bucket-low    { color:#dc2626; }

  /* Fields */
  .field { margin-top:10px; }
  .field-label { font-size:10px; font-weight:600; text-transform:uppercase; letter-spacing:0.5px; color:var(--text-muted); margin-bottom:4px; }
  .field-value { font-size:13px; color:var(--text-primary); font-weight:500; }

  .reasoning-block { border-left:3px solid; border-radius:0 6px 6px 0; padding:8px 10px; font-size:12px; color:var(--text-secondary); line-height:1.65; margin-top:4px; }
  .flash    .reasoning-block { border-color:var(--flash-mid);    background:var(--flash-light); }
  .hawke    .reasoning-block { border-color:var(--hawke-mid);    background:var(--hawke-light); }
  .sherlock .reasoning-block { border-color:var(--sherlock-mid); background:var(--sherlock-light); }
  .invorto  .reasoning-block { border-color:var(--invorto-mid);  background:var(--invorto-light); }

  /* Chips */
  .chip { display:inline-flex; align-items:center; gap:4px; padding:3px 10px; border-radius:20px; font-size:11px; font-weight:600; }
  .chip-anomaly { background:#f1f5f9; color:var(--text-secondary); border:1px solid var(--border); }

  .severity-badge { display:inline-flex; align-items:center; gap:5px; padding:3px 10px; border-radius:6px; font-size:11px; font-weight:700; text-transform:uppercase; letter-spacing:0.4px; }
  .sev-dot { width:6px; height:6px; border-radius:50%; display:inline-block; }
  .sev-critical { background:#fee2e2; color:#dc2626; } .sev-critical .sev-dot { background:#dc2626; }
  .sev-high     { background:#ffedd5; color:#ea580c; } .sev-high     .sev-dot { background:#ea580c; }
  .sev-medium   { background:#fef3c7; color:#d97706; } .sev-medium   .sev-dot { background:#d97706; }
  .sev-low      { background:#dcfce7; color:#16a34a; } .sev-low      .sev-dot { background:#16a34a; }

  /* Confidence bar */
  .conf-wrap   { margin-top:12px; }
  .conf-header { display:flex; justify-content:space-between; align-items:center; margin-bottom:5px; }
  .conf-bar-bg { height:6px; background:var(--border); border-radius:3px; overflow:hidden; }
  .conf-bar-fill { height:100%; border-radius:3px; background:linear-gradient(90deg,#059669,#34d399); width:0%; transition:width 1.3s cubic-bezier(.34,1.56,.64,1); }
  .conf-pct { font-family:'Bricolage Grotesque',sans-serif; font-size:15px; font-weight:700; color:#059669; }

  .two-col { display:flex; gap:10px; flex-wrap:wrap; margin-top:10px; }
  .two-col > * { flex:1 1 calc(50% - 5px); min-width:120px; }

  .divider { height:1px; background:var(--border); margin:12px 0; }

  /* QA */
  .qa-risk-row { display:flex; gap:8px; align-items:center; flex-wrap:wrap; margin-bottom:10px; }
  .risk-badge  { display:inline-flex; align-items:center; gap:4px; padding:3px 10px; border-radius:6px; font-size:11px; font-weight:700; text-transform:uppercase; letter-spacing:0.3px; }
  .risk-high   { background:#fee2e2; color:#dc2626; }
  .risk-medium { background:#fef3c7; color:#b45309; }
  .risk-low    { background:#dcfce7; color:#15803d; }

  .findings-list    { list-style:none; }
  .findings-list li { font-size:12px; color:var(--text-secondary); padding:3px 0 3px 14px; position:relative; line-height:1.5; }
  .findings-list li::before { content:''; position:absolute; left:0; top:9px; width:5px; height:5px; border-radius:50%; background:var(--sherlock-mid); }

  .timestamp { font-size:10px; color:var(--text-muted); margin-top:10px; display:flex; align-items:center; gap:4px; }

  /* Pending state (active agent, no data yet) */
  .pending-body { padding:16px 16px 18px; display:flex; align-items:flex-start; gap:12px; }
  .pending-icon { font-size:20px; flex-shrink:0; margin-top:2px; opacity:0.55; }
  .pending-text strong { font-family:'Bricolage Grotesque',sans-serif; font-size:13px; font-weight:700; display:block; margin-bottom:3px; }
  .pending-text p { font-size:12px; color:var(--text-muted); line-height:1.55; }

  /* Coming Soon state */
  .card.coming-soon { opacity:0.75; }
  .card.coming-soon .card-header { background:#fafbfc; }
  .cs-body { padding:16px 16px 18px; display:flex; align-items:flex-start; gap:12px; }
  .cs-icon { font-size:20px; flex-shrink:0; margin-top:2px; }
  .cs-text strong { font-family:'Bricolage Grotesque',sans-serif; font-size:13px; font-weight:700; display:block; margin-bottom:3px; color:var(--text-primary); }
  .cs-text p { font-size:12px; color:var(--text-muted); line-height:1.55; }

  /* Full empty (both live agents have no data) */
  .empty-notice { background:#fff; border:1px solid var(--border); border-radius:var(--radius); padding:18px 16px; margin-bottom:12px; display:flex; align-items:flex-start; gap:12px; box-shadow:var(--shadow); }
  .empty-notice .en-icon { font-size:22px; flex-shrink:0; }
  .empty-notice strong { font-family:'Bricolage Grotesque',sans-serif; font-size:13px; font-weight:700; display:block; margin-bottom:3px; }
  .empty-notice p { font-size:12px; color:var(--text-muted); line-height:1.55; }

  /* Loading / Error */
  #loading { display:flex; flex-direction:column; align-items:center; justify-content:center; padding:60px 20px; gap:14px; }
  .spinner { width:34px; height:34px; border:3px solid var(--border); border-top-color:#2563eb; border-radius:50%; animation:spin .8s linear infinite; }
  @keyframes spin { to{transform:rotate(360deg)} }
  .loading-text { font-size:12px; color:var(--text-muted); font-weight:500; }
  #error   { display:none; text-align:center; padding:40px 20px; color:var(--text-muted); }
  #content { display:none; }
</style>
</head>
<body>

<div class="header">
  <div>
    <div class="header-title">AI Lab Intelligence</div>
    <div class="header-sub" id="lastUpdated">Loading‚Ä¶</div>
  </div>
  <span class="header-badge">Active</span>
</div>

<div id="loading">
  <div class="spinner"></div>
  <div class="loading-text">Waking up the agents‚Ä¶</div>
</div>

<div id="error">
  <div style="font-size:28px;margin-bottom:10px">‚ö†Ô∏è</div>
  <div style="font-size:13px;font-weight:600;color:#0f1728;margin-bottom:6px">Couldn't reach the intelligence layer</div>
  <div style="font-size:12px">Check the backend or try refreshing.</div>
</div>

<div id="content">
  <div id="emptyNotice" style="display:none" class="empty-notice">
    <div class="en-icon">üîç</div>
    <div>
      <strong>Nothing to report‚Ä¶ yet</strong>
      <p>Flash and Hawke haven't analysed this lead. They'll fire on the next scheduled run ‚Äî check back soon.</p>
    </div>
  </div>
  <div id="cards"></div>
</div>

<script>
const API = 'https://lead-intelligence-api.onrender.com/lead-intelligence';

const pid = () => new URLSearchParams(location.search).get('pid');

function val(v) {
  if (v === null || v === undefined) return null;
  const s = String(v).trim();
  return (!s || ['null','undefined','-','--','n/a','none',''].includes(s.toLowerCase())) ? null : s;
}

function fmtDate(v) {
  if (!v) return null;
  try { const d = new Date(v); return isNaN(d) ? v : d.toLocaleString('en-US',{month:'short',day:'numeric',year:'numeric',hour:'2-digit',minute:'2-digit'}); }
  catch { return v; }
}

const sevClass  = s => { const l=(s||'').toLowerCase(); return l==='critical'?'sev-critical':l==='high'?'sev-high':l==='medium'?'sev-medium':'sev-low'; };
const riskClass = r => { const l=(r||'').toLowerCase(); return l==='high'?'risk-high':l==='medium'?'risk-medium':'risk-low'; };
const bktClass  = b => { const l=(b||'').toLowerCase(); return l==='high'?'bucket-high':l==='medium'?'bucket-medium':'bucket-low'; };

/* ‚îÄ‚îÄ Agent Flash ‚îÄ‚îÄ */
function buildFlash(d) {
  const score  = val(d.mx_AI_Readiness_Score);
  const bucket = val(d.mx_Readiness_Bucket);
  const intent = val(d.mx_AI_Detected_Intent);
  const reason = val(d.mx_AI_Reasoning);
  const has    = score||bucket||intent||reason;

  const n = parseInt(score)||0;
  const r = 27, circ = +(2*Math.PI*r).toFixed(2);
  const offset = +(circ-(n/100)*circ).toFixed(2);
  const stroke = !score ? '#e4e8f0' : (bucket||'').toLowerCase()==='high' ? '#16a34a' : (bucket||'').toLowerCase()==='medium' ? '#d97706' : '#dc2626';

  const body = has ? `
    <div class="card-body">
      ${(score||bucket)?`<div class="score-row">
        ${score?`<div class="score-ring-wrap"><svg width="68" height="68" viewBox="0 0 68 68">
          <circle class="score-ring-bg" cx="34" cy="34" r="${r}"/>
          <circle class="score-ring-fill" cx="34" cy="34" r="${r}" stroke="${stroke}"
            stroke-dasharray="${circ}" stroke-dashoffset="${circ}"
            data-offset="${offset}" id="flashRing"/>
        </svg><div class="score-value">${n}<small>/100</small></div></div>`:''}
        ${bucket?`<div class="score-meta"><div class="readiness-label">Readiness Score</div><div class="readiness-bucket ${bktClass(bucket)}">${bucket}</div></div>`:''}
      </div>`:''}
      ${intent?`<div class="field"><div class="field-label">Detected Intent</div><div class="field-value">${intent}</div></div>`:''}
      ${reason?`<div class="field"><div class="field-label">AI Reasoning</div><div class="reasoning-block">${reason}</div></div>`:''}
    </div>` : `
    <div class="pending-body">
      <div class="pending-icon">‚è≥</div>
      <div class="pending-text">
        <strong>Analysis pending</strong>
        <p>Flash fires within 60 seconds of the next lead activity. Nothing to score yet.</p>
      </div>
    </div>`;

  return `<div class="card flash"><div class="card-accent"></div>
    <div class="card-header">
      <div class="agent-icon">‚ö°</div>
      <div><div class="agent-name">Agent Flash</div><div class="agent-tagline">60 Seconds to Schedule</div></div>
      <span class="agent-status status-active">Active</span>
    </div>${body}</div>`;
}

/* ‚îÄ‚îÄ Agent Hawke ‚îÄ‚îÄ */
function buildHawke(d) {
  const anomType = val(d.mx_Latest_Anomaly_Type);
  const severity = val(d.mx_Latest_Anomaly_Severity);
  const conf     = val(d.mx_Latest_Anomaly_Confidence);
  const lastRun  = val(d.mx_Last_Intelligence_Run);
  const explain  = val(d.mx_Latest_Anomaly_Explanation);
  const status   = val(d.mx_AI_Anomaly_Status);
  const has      = anomType||severity||conf||explain||status||lastRun;
  const confNum  = parseInt(conf)||0;

  const body = has ? `
    <div class="card-body">
      ${(anomType||severity)?`<div class="two-col">
        ${anomType?`<div class="field"><div class="field-label">Anomaly Type</div><div class="field-value"><span class="chip chip-anomaly">${anomType}</span></div></div>`:''}
        ${severity?`<div class="field"><div class="field-label">Severity</div><div class="field-value"><span class="severity-badge ${sevClass(severity)}"><span class="sev-dot"></span>${severity}</span></div></div>`:''}
      </div>`:''}
      ${conf?`<div class="conf-wrap"><div class="conf-header"><div class="field-label">Confidence</div><div class="conf-pct" id="confPct">0%</div></div><div class="conf-bar-bg"><div class="conf-bar-fill" data-pct="${confNum}" id="confBar"></div></div></div>`:''}
      ${explain?`<div class="field"><div class="field-label">Explanation</div><div class="reasoning-block">${explain}</div></div>`:''}
      ${status?`<div class="field"><div class="field-label">Status</div><div class="field-value">${status}</div></div>`:''}
      ${lastRun?`<div class="timestamp">üïê Last run: ${fmtDate(lastRun)}</div>`:''}
    </div>` : `
    <div class="pending-body">
      <div class="pending-icon">ü¶Ö</div>
      <div class="pending-text">
        <strong>No anomalies on radar</strong>
        <p>Hawke sweeps CRM &amp; SIS on schedule. Results will appear after the next scan.</p>
      </div>
    </div>`;

  return `<div class="card hawke"><div class="card-accent"></div>
    <div class="card-header">
      <div class="agent-icon">ü¶Ö</div>
      <div><div class="agent-name">Agent Hawke</div><div class="agent-tagline">Anomaly Detection</div></div>
      <span class="agent-status status-active">Active</span>
    </div>${body}</div>`;
}

/* ‚îÄ‚îÄ Agent Sherlock ‚îÄ‚îÄ Coming Soon ‚îÄ‚îÄ */
function buildSherlock(d) {
  const status   = val(d.mx_QA_Status);
  const risk     = val(d.mx_QA_Risk_Level);
  const summary  = val(d.mx_QA_Summary);
  const findings = val(d.mx_QA_Key_Findings);
  const advisory = val(d.mx_QA_Advisory_Notes);
  const concerns = val(d.mx_QA_Concerns);
  const has      = status||risk||summary||findings||advisory||concerns;

  let body;
  if (has) {
    const fl = findings ? findings.split(/[;|\n]/).map(f=>f.trim()).filter(f=>f.length>2) : [];
    body = `<div class="card-body">
      ${(status||risk)?`<div class="qa-risk-row">${status?`<span class="chip chip-anomaly">${status}</span>`:''} ${risk?`<span class="risk-badge ${riskClass(risk)}">${risk} Risk</span>`:''}</div>`:''}
      ${summary?`<div class="field"><div class="field-label">Summary</div><div class="reasoning-block">${summary}</div></div>`:''}
      ${fl.length?`<div class="field"><div class="field-label">Key Findings</div><ul class="findings-list">${fl.map(f=>`<li>${f}</li>`).join('')}</ul></div>`: findings?`<div class="field"><div class="field-label">Key Findings</div><div class="reasoning-block">${findings}</div></div>`:''}
      ${advisory?`<div class="divider"></div><div class="field"><div class="field-label">Advisory Notes</div><div class="reasoning-block">${advisory}</div></div>`:''}
      ${concerns?`<div class="field"><div class="field-label">Concerns</div><div class="reasoning-block">${concerns}</div></div>`:''}
    </div>`;
  } else {
    body = `<div class="cs-body">
      <div class="cs-icon">üîé</div>
      <div class="cs-text">
        <strong>Coming soon ‚Äî Intake QA</strong>
        <p>Sherlock is still sharpening its magnifying glass. Application completeness checks, missing doc flags, and risk scoring are on the way.</p>
      </div>
    </div>`;
  }

  return `<div class="card sherlock${has?'':' coming-soon'}"><div class="card-accent"></div>
    <div class="card-header">
      <div class="agent-icon">üîé</div>
      <div><div class="agent-name">Agent Sherlock</div><div class="agent-tagline">Intake QA Review</div></div>
      <span class="agent-status ${has?'status-active':'status-soon'}">${has?'Active':'Soon'}</span>
    </div>${body}</div>`;
}

/* ‚îÄ‚îÄ Invorto Voice ‚îÄ‚îÄ Coming Soon ‚îÄ‚îÄ */
function buildInvorto(d) {
  const hesitation = val(d.mx_Primary_Hesitation);
  const motivation = val(d.mx_Motivation_Trigger);
  const owner      = val(d.mx_Decision_Owner);
  const timeline   = val(d.mx_Enrollment_Timeline_Voice_Call);
  const has        = hesitation||motivation||owner||timeline;

  let body;
  if (has) {
    body = `<div class="card-body">
      ${hesitation?`<div class="field"><div class="field-label">Primary Hesitation</div><div class="reasoning-block">${hesitation}</div></div>`:''}
      ${motivation?`<div class="field"><div class="field-label">Motivation Trigger</div><div class="field-value">${motivation}</div></div>`:''}
      ${(owner||timeline)?`<div class="two-col">
        ${owner   ?`<div class="field"><div class="field-label">Decision Owner</div><div class="field-value">${owner}</div></div>`:''}
        ${timeline?`<div class="field"><div class="field-label">Enrollment Timeline</div><div class="field-value">${timeline}</div></div>`:''}
      </div>`:''}
    </div>`;
  } else {
    body = `<div class="cs-body">
      <div class="cs-icon">üéôÔ∏è</div>
      <div class="cs-text">
        <strong>Coming soon ‚Äî Voice Intelligence</strong>
        <p>Invorto is waiting for its first call. Once the voice bot engages, hesitations, motivations, and timelines will surface here.</p>
      </div>
    </div>`;
  }

  return `<div class="card invorto${has?'':' coming-soon'}"><div class="card-accent"></div>
    <div class="card-header">
      <div class="agent-icon">üéôÔ∏è</div>
      <div><div class="agent-name">Invorto Voice</div><div class="agent-tagline">Voice Call Intelligence</div></div>
      <span class="agent-status ${has?'status-active':'status-soon'}">${has?'Active':'Soon'}</span>
    </div>${body}</div>`;
}

/* ‚îÄ‚îÄ Animate ‚îÄ‚îÄ */
function animate() {
  const ring = document.getElementById('flashRing');
  if (ring) setTimeout(()=>{ ring.style.strokeDashoffset = ring.dataset.offset; }, 120);
  const bar = document.getElementById('confBar'), pct = document.getElementById('confPct');
  if (bar) setTimeout(()=>{ const p=parseFloat(bar.dataset.pct); bar.style.width=p+'%'; if(pct)pct.textContent=p+'%'; }, 220);
}

/* ‚îÄ‚îÄ Init ‚îÄ‚îÄ */
async function init() {
  const p = pid();
  const loadEl    = document.getElementById('loading');
  const contentEl = document.getElementById('content');
  const errorEl   = document.getElementById('error');
  const cardsEl   = document.getElementById('cards');
  const emptyEl   = document.getElementById('emptyNotice');
  const subEl     = document.getElementById('lastUpdated');

  if (!p) {
    loadEl.style.display='none'; errorEl.style.display='block';
    errorEl.querySelector('div:last-child').textContent = 'No lead ID (pid) found in URL.';
    return;
  }

  try {
    const res = await fetch(`${API}?pid=${encodeURIComponent(p)}`);
    if (!res.ok) throw new Error(res.status);
    const d = await res.json();

    loadEl.style.display='none';
    contentEl.style.display='block';
    subEl.textContent = 'Updated ' + new Date().toLocaleTimeString('en-US',{hour:'2-digit',minute:'2-digit'});

    const flashHas = val(d.mx_AI_Readiness_Score)||val(d.mx_Readiness_Bucket)||val(d.mx_AI_Detected_Intent)||val(d.mx_AI_Reasoning);
    const hawkeHas = val(d.mx_Latest_Anomaly_Type)||val(d.mx_Latest_Anomaly_Severity)||val(d.mx_Latest_Anomaly_Confidence)||val(d.mx_Latest_Anomaly_Explanation)||val(d.mx_AI_Anomaly_Status)||val(d.mx_Last_Intelligence_Run);

    if (!flashHas && !hawkeHas) emptyEl.style.display='flex';

    cardsEl.innerHTML = [buildFlash(d), buildHawke(d), buildSherlock(d), buildInvorto(d)].join('');
    animate();

  } catch(e) {
    loadEl.style.display='none';
    errorEl.style.display='block';
  }
}

init();
</script>
</body>
</html>
